{% extends "base.html" %}
{% block title %}Public Data Manager{% endblock %}
{% block header_title %}Public Data Manager{% endblock %}

{% block header_extra %}
<a href="{{ url_for('admin_logout') }}" class="text-sm text-red-500 hover:text-red-700 font-medium">
    <i class="fa-solid fa-right-from-bracket mr-1"></i> Logout
</a>
{% endblock %}

{% block content %}
<div class="flex flex-col gap-6">
    
    <div class="flex flex-col md:flex-row justify-between items-center bg-gray-50 dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700">
        
        <nav class="flex text-sm text-gray-600 dark:text-gray-300 overflow-x-auto whitespace-nowrap pb-2 md:pb-0 w-full md:w-auto">
            {% for crumb in breadcrumbs %}
                {% if not loop.first %}<span class="mx-2 text-gray-400">/</span>{% endif %}
                <a href="{{ url_for('public_manager', path=crumb.path) }}" class="hover:text-primary font-medium flex items-center">
                    {% if loop.first %}<i class="fa-solid fa-house mr-1"></i>{% endif %}
                    {{ crumb.name }}
                </a>
            {% endfor %}
        </nav>

        <div class="flex gap-2 w-full md:w-auto mt-2 md:mt-0">
            <button onclick="document.getElementById('modal-folder').classList.remove('hidden')" 
                class="flex-1 md:flex-none px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-sm font-medium hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                <i class="fa-solid fa-folder-plus mr-1 text-yellow-500"></i> New Folder
            </button>
            <button onclick="document.getElementById('modal-upload').classList.remove('hidden')" 
                class="flex-1 md:flex-none px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors shadow-sm">
                <i class="fa-solid fa-cloud-arrow-up mr-1"></i> Upload Files
            </button>
        </div>
    </div>

    <div class="border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden shadow-sm bg-white dark:bg-dark-card min-h-[400px]">
        <table class="min-w-full text-sm text-left">
            <thead class="bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400 font-medium">
                <tr>
                    <th class="px-6 py-3 w-10">Type</th>
                    <th class="px-6 py-3">Name</th>
                    <th class="px-6 py-3 w-24">Size</th>
                    <th class="px-6 py-3 w-20 text-center">Action</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                {% if current_path %}
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50 cursor-pointer" 
                    onclick="window.location.href='{{ url_for('public_manager', path=current_path.split('/')[:-1]|join('/')) }}'">
                    <td class="px-6 py-3 text-center"><i class="fa-solid fa-turn-up text-gray-400"></i></td>
                    <td class="px-6 py-3 font-medium text-gray-500">.. (Back)</td>
                    <td></td><td></td>
                </tr>
                {% endif %}

                {% for item in items %}
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50 group transition-colors">
                    <td class="px-6 py-4 text-center text-lg">
                        {% if item.is_dir %}
                            <i class="fa-solid fa-folder text-yellow-400"></i>
                        {% else %}
                            <i class="fa-solid fa-file-csv text-green-500"></i>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4">
                        {% if item.is_dir %}
                            <a href="{{ url_for('public_manager', path=item.path) }}" class="font-bold text-gray-800 dark:text-gray-200 hover:text-primary block">{{ item.name }}</a>
                        {% else %}
                            <span class="text-gray-700 dark:text-gray-300 block">{{ item.name }}</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-gray-500 text-xs">{{ item.size }}</td>
                    <td class="px-6 py-4 text-center">
                        <form method="post" action="{{ url_for('admin_action') }}" onsubmit="return confirm('Delete this item permanently?');">
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="current_path" value="{{ current_path }}">
                            <input type="hidden" name="item_path" value="{{ item.path }}">
                            <button type="submit" class="text-gray-400 hover:text-red-500 transition-colors p-2 rounded-full hover:bg-red-50 dark:hover:bg-red-900/20">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" class="px-6 py-10 text-center text-gray-400">
                        <div class="flex flex-col items-center">
                            <i class="fa-regular fa-folder-open text-4xl mb-2 opacity-50"></i>
                            <p>Empty Folder</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div id="modal-folder" class="hidden fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4">
    <div class="bg-white dark:bg-dark-card w-full max-w-sm rounded-xl shadow-2xl p-6 border border-gray-200 dark:border-gray-700">
        <h3 class="text-lg font-bold mb-4 text-gray-800 dark:text-gray-100">Create New Folder</h3>
        <form method="post" action="{{ url_for('admin_action') }}">
            <input type="hidden" name="action" value="create_folder">
            <input type="hidden" name="current_path" value="{{ current_path }}">
            <input type="text" name="folder_name" placeholder="Folder Name (e.g. Deoghar)" required 
                class="w-full p-3 mb-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-900 text-sm">
            <div class="flex justify-end gap-2">
                <button type="button" onclick="document.getElementById('modal-folder').classList.add('hidden')" class="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg">Create</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-upload" class="hidden fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4">
    <div class="bg-white dark:bg-dark-card w-full max-w-sm rounded-xl shadow-2xl p-6 border border-gray-200 dark:border-gray-700">
        <h3 class="text-lg font-bold mb-4 text-gray-800 dark:text-gray-100">Upload Files</h3>
        <form method="post" action="{{ url_for('admin_action') }}" enctype="multipart/form-data">
            <input type="hidden" name="action" value="upload_file">
            <input type="hidden" name="current_path" value="{{ current_path }}">
            <input type="file" name="files" multiple required class="w-full p-2 mb-4 border rounded text-sm bg-gray-50 dark:bg-gray-900">
            <div class="flex justify-end gap-2">
                <button type="button" onclick="document.getElementById('modal-upload').classList.add('hidden')" class="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded-lg">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg">Upload</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}